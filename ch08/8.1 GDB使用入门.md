## 8.1 GDBä½¿ç”¨å…¥é—¨

### 8.1.1 ä»€ä¹ˆæ˜¯gdb

GDB(the GNU Project debugger)æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„å¼€æºè°ƒè¯•å™¨ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…è·Ÿè¸ªç¨‹åºè¿è¡Œæ—¶çš„å†…éƒ¨çŠ¶æ€ï¼ŒååŠ©å¼€å‘è€…å®šä½ç¨‹åºä¸­çš„é—®é¢˜æ‰€åœ¨ã€‚

### 8.1.2 gdbå·¥ä½œåŸç†

gdbçš„æ ¸å¿ƒåŸç†æ˜¯å†…æ ¸çš„ptraceç³»ç»Ÿè°ƒç”¨ï¼Œptraceå¯¹è¿›ç¨‹çš„å†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œè§‚å¯Ÿå’Œä¿®æ”¹ï¼š

```c
long ptrace(enum __ptrace_request request, pid_t pid, void *addr, void *data);
```

è¿™ä¸ªç³»ç»Ÿè°ƒç”¨çš„ä¸»è¦ä½œç”¨å°±æ˜¯å…è®¸è¿›ç¨‹æŸ¥è¯¢å’Œä¿®æ”¹è¢«è§‚å¯Ÿè¿›ç¨‹çš„ä»»æ„å†…å­˜æ•°æ®ã€‚

å…¶ä¸­__ptrace_requestä¸»è¦ä½¿ç”¨åˆ°çš„å–å€¼ä¸ºï¼š

```c
PTRACE_TRACEME
PTRACE_ATTACH
```

å½“é€šè¿‡gdbå¯åŠ¨è¿›ç¨‹æ—¶ï¼Œä¼šä½¿ç”¨PTRACE_TRACEMEæ¥å»ºç«‹gdbå’Œè¢«è°ƒè¯•å­è¿›ç¨‹ç›´æ¥çš„å…³ç³»ï¼Œè€Œå½“ä½¿ç”¨gdbçš„attachå‘½ä»¤æ—¶ï¼Œåˆ™ä¼šé€šè¿‡PTRACE_ATTACHæ¥å»ºç«‹è”ç³»ã€‚

è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œptraceå‚æ•°ä¸­çš„pidæ˜¯æŒ‡è¿›ç¨‹ä¸­çº¿ç¨‹idï¼Œè€Œä¸æ˜¯è¢«è°ƒè¯•çš„è¿›ç¨‹idï¼ˆprocess idï¼‰ï¼Œå¯¹äºä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºï¼Œéœ€è¦å¤šæ¬¡è°ƒç”¨ptraceæ¥ç›‘æ§è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹ã€‚

### 8.1.3 gdbåŸºæœ¬å‘½ä»¤

é»˜è®¤æƒ…å†µä¸‹ï¼Œgdbé€šè¿‡äº¤äº’å¼çš„shellè¿›è¡Œè°ƒè¯•ï¼Œæ—¢ç›´æ¥å¯åŠ¨gdbç¨‹åºï¼Œä¼šè¿›å…¥åˆ°gdbçš„shellä¸­ï¼Œåœ¨shellä¸­è¾“å…¥helpï¼Œå¯ä»¥æŸ¥çœ‹å¸¸ç”¨çš„gdbå‘½ä»¤ã€‚è¿™é‡Œä»‹ç»å‡ ä¸ªè°ƒè¯•ä¸­éœ€è¦ç”¨åˆ°çš„å‘½ä»¤ï¼š

- file

  fileå‘½ä»¤ç”¨äºæŒ‡ç¤ºè¢«è°ƒè¯•æ–‡ä»¶çš„è·¯å¾„ï¼Œå¹¶ä¸”fileä¼šå¯¹PATHç¯å¢ƒå˜é‡è¿›è¡Œæœç´¢ï¼Œä»¥æ‰¾åˆ°åŒ¹é…çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚

- run

  å½“ä½¿ç”¨fileæŒ‡å®šäº†è¢«è°ƒè¯•çš„å¯æ‰§è¡Œç¨‹åºè·¯å¾„åï¼Œå°±å¯ä»¥ä½¿ç”¨runå‘½ä»¤æ¥å¯åŠ¨å¯æ‰§è¡Œç¨‹åºäº†ã€‚å½“ç„¶ï¼Œåœ¨å¯åŠ¨ç¨‹åºä¹‹å‰ï¼Œæœ€å¥½å…ˆè¿˜è®¾ç½®ä¸€ä¸‹ç¨‹åºæ–­ç‚¹ã€‚è¿™ä¼šç”¨åˆ°break/watchå‘½ä»¤ã€‚

- break

  breakæ˜¯gdbä¸­æœ€å¸¸ç”¨çš„å‘½ä»¤ä¹‹ä¸€ï¼Œé…åˆprintå¯ä»¥å¯¹ç¨‹åºçš„è¿è¡ŒçŠ¶æ€è¿›è¡Œè§‚å¯Ÿã€‚breakçš„åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š

```gdb
break [PROBE_MODIFIER] [LOCATION] [thread THREADNUM] [if CONDITION]
```

åœ¨breakå‘½ä»¤ä¸­ï¼ŒLOCATIONç”¨äºæŒ‡ç¤ºæ–­ç‚¹çš„å…·ä½“ä½ç½®ï¼Œå¯ä»¥é€šè¿‡æ–‡ä»¶åè¡Œå·ï¼Œå‡½æ•°åç§°ç­‰æ¥å¯¹æ–­ç‚¹è¿›è¡Œå®šä½ã€‚ä¾‹å¤–å¦‚è¯¥æƒ³åœ¨æ–‡ä»¶çš„æŒ‡å®šä½ç½®è¿›è¡Œå®šä½ï¼Œéœ€è¦ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š

```gdb
break test.c:18
```

å¦‚è¯¥æƒ³å¯¹æŒ‡å®šå‡½æ•°è¿›è¡Œæ–­ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š

```gdb
break Dtk::Core::DObject::DObject
```

- watch

ç”¨äºæŸ¥çœ‹å†…å­˜ä¸­çš„å˜é‡å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–

- list

ä½¿ç”¨è¯¥åŠŸèƒ½æ—¶éœ€è¦åŒæ—¶é…ç½®æºç è·¯å¾„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œlistå‘½ä»¤æŸ¥çœ‹å½“å‰è¿è¡Œå¤„çš„ä»£ç ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ¶å®šéœ€è¦æŸ¥çœ‹çš„æºç æ–‡ä»¶å’Œè¡Œå·ã€‚

- next/step

ä¸¤è€…å‡æ˜¯å•æ­¥æ‰§è¡Œç¨‹åºï¼Œå¯ä»¥æ¥å—æ•´å½¢ä½œä¸ºå‚æ•°ï¼Œè¡¨ç¤ºé‡å¤æ‰§è¡Œå‘½ä»¤å¤šæ¬¡ã€‚nextåŒæ ·ä¹Ÿæ˜¯å•æ­¥æ‰§è¡Œç¨‹åºï¼Œä½†æ˜¯å’Œstepçš„åŒºåˆ«æ˜¯nextä¼šè·³è¿‡å­å‡½æ•°çš„è°ƒç”¨ã€‚åœ¨ä½¿ç”¨gdbçš„è¿‡ç¨‹ä¸­å¦‚æœå¯¹å‘½ä»¤çš„ä½¿ç”¨æœ‰ç–‘é—®ï¼Œå¯ä»¥ä½¿ç”¨helpæŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š
  
```bash
(gdb) help step
Step program until it reaches a different source line.
Usage: step [N]
Argument N means step N times (or till program stops for another reason).
(gdb) help next
Step program, proceeding through subroutine calls.
Usage: next [N]
Unlike "step", if the current source line calls a subroutine,
this command does not enter the subroutine, but instead steps over
the call, in effect treating it as a single source line.
```

ä¸‹é¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€æ®µæœ‰é”™è¯¯çš„ä»£ç æ¥çœ‹çœ‹gdbå¦‚ä½•è¿›è¡Œè°ƒè¯•çš„ã€‚

```c
// main.c
#include <stdio.h>

int main() {
    void* arr[3] = {0};
    int invalid= *(int*)(arr[0]);
    printf("invalid is: %d", invalid);
    return -1;
}
```

ç¼–è¯‘è¿è¡Œç¨‹åº

```bash
gcc -g main.c && ./a.out
æ®µé”™è¯¯ (æ ¸å¿ƒå·²è½¬å‚¨)
```

å¯ä»¥çœ‹åˆ°ç¨‹åºå‡ºç°æ®µé”™è¯¯ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨gdbæ¥å¯¹ç¨‹åºè¿›è¡Œè°ƒè¯•ã€‚

é¦–å…ˆå¯åŠ¨gdbï¼Œé€šè¿‡fileå‘½ä»¤åŠ è½½è¢«è°ƒè¯•æŸ¥è¯¢ã€‚

```bash
â”ŒğŸ’  iceyer @ ğŸ’»  builder in ğŸ“  ~/book-toc on ğŸŒ¿  master â†’ origin âŒ€2 âœ—
â””â¯gdb
GNU gdb (Debian 7.12-6+b2) 7.12.0.20161007-git
Copyright (C) 2016 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word".
(gdb) file a.out
Reading symbols from a.out...(no debugging symbols found)...done.(gdb)file a.out
```

è¾“å…¥runå‘½ä»¤è¿è¡Œç¨‹åºï¼š

```bash
(gdb) run
Starting program: /home/iceyer/book-toc/ch08/8.1-simple-debug/a.out 

Program received signal SIGSEGV, Segmentation fault.
0x0000555555554666 in main () at main.c:6
6	    int invalid= *(int*)(arr[0]);
```

å¯ä»¥çœ‹åˆ°ç¨‹åºè¿è¡Œåï¼Œæ”¶åˆ°SIGSEGVé”™è¯¯é€€å‡ºï¼ŒSIGSEGVä¸€èˆ¬æ˜¯å†…å­˜é”™è¯¯æˆ–è€…æ®µé”™è¯¯å¯¼è‡´çš„ã€‚

è§‚å¯Ÿgdbçš„é”™è¯¯æç¤ºï¼Œç°åœ¨ç¨‹åºåœ¨main.cçš„ç¬¬6è¡Œå‘ç”Ÿé”™è¯¯ï¼Œé”™è¯¯çš„ä»£ç ä¸ºï¼š

```c
	    int invalid= *(int*)(arr[0]);
```

è€ƒè™‘åˆ°è¿™é‡Œå‘ç”Ÿäº†å†…å­˜é”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥ä¸€ä¸‹è¢«ä½¿ç”¨çš„å˜é‡åªæ˜¯å¦æ­£å¸¸ï¼Œä½¿ç”¨printå‘½ä»¤æ¥æŸ¥çœ‹å˜é‡è¿™å†…å­˜ä¸­çš„å€¼ï¼š

```gdb
(gdb) print arr
$1 = {0x0, 0x0, 0x0}
(gdb) print arr[0]
$2 = (void *) 0x0
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œå¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºè¢«å¼•ç”¨çš„arr[0]å€¼ä¸º0ï¼Œé‚£ä¹ˆarr[0]çš„å€¼æ˜¯åœ¨ä½•å¤„åˆå§‹åŒ–çš„å‘¢ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨åˆ°listå‘½ä»¤ï¼š

```gdb
(gdb) list
1	#include <stdlib.h>
2	#include <stdio.h>
3	
4	int main() {
5	    void* arr[3] = {0};
6	    int invalid= *(int*)(arr[0]);
7	    printf("invalid is: %d", invalid);
8	    return -1;
9	}
```

ä½¿ç”¨listå‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰æ–­ç‚¹ä½ç½®å‰åçš„æºç ï¼Œé€šè¿‡æºç å¯ä»¥æ˜æ˜¾çœ‹åˆ°ï¼Œåœ¨arråˆå§‹åŒ–æ—¶ï¼Œå…¶å€¼å°±æ˜¯{0}ã€‚

é€šè¿‡ä¸Šé¢çš„ç®€å•ä¾‹å­ï¼Œæˆ‘ä»¬ç®€å•äº†è§£äº†å¦‚ä½•ä½¿ç”¨gdbå¯¹ç¨‹åºè¿›è¡Œç®€å•çš„è°ƒè¯•ã€‚ä¸‹é¢æˆ‘ä»¬å†çœ‹ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ç¤ºä¾‹ã€‚

å‡è®¾åœ¨ä¸€ä¸ªç¨‹åºä¸­ï¼Œä¸€äº›é—®é¢˜éšè—çš„æ¯”è¾ƒæ·±å…¥ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦é€šè¿‡æ–­ç‚¹å’Œè°ƒç”¨æ ˆæ¥æ›´è¿›ä¸€æ­¥çš„è·å–ç¨‹åºä¿¡æ¯ã€‚ä»¥å¦‚ä¸‹çš„ç¨‹åºä¸ºä¾‹ï¼š

```c
#include <stdio.h>

typedef struct item_
{
    int key;
    int value;
} item;

int sort(item *data, size_t size)
{
    for (size_t i = 0; i < size; ++i)
    {
        for (size_t j = i; j < size - i - 1; ++j)
        {
            if (data[j].key >= data[j + 1].key)
            {
                // swap data[j] and data[j+1];
                item tmp = data[i];
                data[i] = data[j];
                data[j] = tmp;
            }
        }
    }
}

void dump(item *data, size_t size)
{
    for (int i = 0; i < size; ++i)
    {
        printf("data[%d] is key=%d, value=%d\n", i, data[i].key, data[i].value);
    }
}

int main()
{
    item data[3];
    int size = sizeof(data) / sizeof(data[0]);

    data[0].key = 10;
    data[0].value = 1;
    data[1].key = 10;
    data[1].value = 2;
    data[2].key = 2;
    data[2].value = 3;

    printf("before sort:\n");
    dump(data, size);

    sort(data, size);

    printf("\nafter sort:\n");
    dump(data, size);
}

```

è¿™ä¸ªç¨‹åºæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ’åºç¨‹åºï¼Œç¨‹åºæ ¹æ®itemé‡Œé¢çš„keyè¿›è¡Œæ’åºï¼Œå¹¶è¾“å‡ºæ’åºç»“æœã€‚è¿è¡Œç¨‹åºç»“æœå¦‚ä¸‹ï¼š

```bash
â”ŒğŸ’  iceyer @ ğŸ’»  alienware-deepin in ğŸ“  8.2-command-debug on ğŸŒ¿  master âŒ€6 âœ—
â””â¯ gcc -g main.c && ./a.out
before sort:
data[0] is key=10, value=1
data[1] is key=10, value=2
data[2] is key=2, value=3

after sort:
data[0] is key=2, value=3
data[1] is key=10, value=2
data[2] is key=10, value=1
```

å¯ä»¥çœ‹åˆ°ï¼Œæ’åºçš„ç»“æœä¸­keyçš„ç¡®æ˜¯æŒ‰ç…§ç”±å°åˆ°å¤§çš„é¡ºåºæ’åˆ—ï¼Œä½†æ˜¯éœ€è¦ç•™æ„çš„æ˜¯ï¼Œåœ¨æ’åºä¹‹å‰ï¼Œvalue=1çš„å…ƒç´ æ˜¯åœ¨value=2çš„å…ƒç´ ä¹‹å‰çš„ï¼Œä½†æ˜¯åœ¨æ’åºå®Œæˆåï¼Œä¸¤è€…çš„ä½ç½®å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™è¯´æ˜è¿™ä¸ªç®—æ³•æ˜¯ä¸ç¨³å®šçš„ã€‚ç„¶è€Œæˆ‘ä»¬çŸ¥é“ï¼Œå†’æ³¡æ’åºçš„ç®—æ³•åº”è¯¥æ˜¯ä¸€ä¸ªç¨³å®šçš„ç®—æ³•ï¼Œæ‰€ä»¥è¿™ä¸ªç¨‹åºåœ¨å¯¹ç®—æ³•çš„å®ç°ä¸Šæ˜¯æœ‰äº›é—®é¢˜çš„ã€‚

è¿™æ—¶å¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡gdbè§‚å¯Ÿä¸€ä¸‹è¿è¡Œè¿‡ç¨‹ä¸­çš„æ•°æ®å˜åŒ–ï¼Œgdbåˆ™æ˜¯ä¸€ä¸ªæä½³çš„å·¥å…·ã€‚é¦–å…ˆåŠ è½½åº”ç”¨ç¨‹åºã€‚

```
file a.out
```

é€šè¿‡æŸ¥çœ‹æºç ï¼Œæˆ‘ä»¬åœ¨20è¡Œè®¾ç½®æ–­ç‚¹å¹¶ä¸”è§‚å¯Ÿè¿™æ—¶è¢«æ’åºçš„æ•°ç»„é‡Œé¢çš„å†…å®¹ï¼š

```
(gdb) break main.c:13
Breakpoint 3 at 0x5555555546a3: file main.c, line 13.
(gdb) run
Starting program: /home/iceyer/book-toc/ch08/8.2-command-debug/a.out 
before sort:
data[0] is key=10, value=1
data[1] is key=10, value=2
data[2] is key=2, value=3

Breakpoint 3, sort (data=0x7fffffffc590, size=3) at main.c:13
13	        for (size_t j = 0; j < size - i - 1; ++j)
(gdb) print {data[0],data[1],data[2]}
$7 = {{key = 10, value = 1}, {key = 10, value = 2}, {key = 2, value = 3}}
```

é€šè¿‡continueå‘½ä»¤å¯ä»¥è®©ç¨‹åºç»§ç»­è¿è¡Œï¼Œé€šè¿‡printå‘½ä»¤æŸ¥çœ‹æ’åºæ•°æ®ï¼š

```
(gdb) print {data[0],data[1],data[2]}
$15 = {{key = 10, value = 2}, {key = 10, value = 1}, {key = 2, value = 3}}
(gdb) continue
```

é€šè¿‡ä¸æ–­çš„é‡å¤è¾“å…¥printå’Œcontinueå‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„æŸ¥çœ‹æ’åºè¿‡ç¨‹ä¸­çš„ä¸­é—´ç»“æœã€‚ä½†æ˜¯ï¼Œå¦‚æœæ’åºçš„å…ƒç´ è¿‡å¤šçš„æ—¶å€™ï¼Œè¿™æ˜¾ç„¶ä¼šæå¤§å¢åŠ å·¥ä½œé‡ï¼Œè¿™æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨commandå‘½ä»¤ï¼Œcommandå‘½ä»¤å¯ä»¥åœ¨ç¨‹åºåœæ­¢åœ¨æ–­ç‚¹çš„æ—¶å€™ï¼Œè‡ªåŠ¨æ‰§è¡Œå‘½ä»¤ï¼Œå…¶ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š

```
(gdb) break main.c:15
Breakpoint 1 at 0x6b0: file main.c, line 15.
(gdb) commands
Type commands for breakpoint(s) 1, one per line.
End with a line saying just "end".
>print {data[0],data[1],data[2]}
>continue
>end
```

åœ¨è®¾ç½®å¥½æ–­ç‚¹åï¼Œç«‹åˆ»æ‰§è¡Œcommandå‘½ä»¤æ¥é…ç½®è¿™ä¸ªæ–­ç‚¹ã€‚åœ¨æ–­ç‚¹ä¸­å¯ä»¥ä½¿ç”¨printæ‰“å°å˜é‡å€¼ï¼Œæ‰“å°å®Œæˆåä½¿ç”¨continueå‘½ä»¤è®©ç¨‹åºç»§ç»­æ‰§è¡Œã€‚å…¶è¿è¡Œç»“æœå¦‚ä¸‹ï¼ˆå·²å¿½ç•¥ä¸é‡è¦éƒ¨åˆ†ï¼‰ï¼š

```gdb
$1 = {{key = 10, value = 1}, {key = 10, value = 2}, {key = 2, value = 3}}
$2 = {{key = 10, value = 2}, {key = 10, value = 1}, {key = 2, value = 3}}
$3 = {{key = 10, value = 2}, {key = 2, value = 3}, {key = 10, value = 1}}
```

å¯ä»¥æ–¹ä¾¿çš„çœ‹åˆ°ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ¯”è¾ƒæ¥å—åï¼Œdata[0]å’Œdata[1]çš„äº’æ¢äº†ä½ç½®ï¼Œè¯´æ˜åœ¨keyç›¸åŒçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ’åºç®—æ³•è¿˜æ˜¯ä¼šå¯¹è¢«æ’åºå†…å®¹è¿›è¡Œäº¤æ¢ï¼Œè¿™æ—¶çœ‹ä»£ç ï¼Œå‘ç”Ÿåœ¨è¿›è¡Œæ’åºæ¯”è¾ƒæ—¶ï¼Œè®²`>`è¿ç®—ç¬¦å†™æˆäº†`>=`è¿ç®—ç¬¦ï¼Œå¯¼è‡´æ’åºç®—æ³•å˜æˆäº†ä¸ç¨³å®šæ’åºï¼Œä¿®å¤åå³å¯çœ‹åˆ°æ­£ç¡®ç»“æœã€‚

### 8.1.4 gdbè°ƒè¯•è„šæœ¬

å¯¹äºå®é™…å·¥ç¨‹ä¸­ï¼Œå¯ä»¥éœ€è¦å¯¹ç¨‹åºè¿›è¡Œè¾ƒä¸ºå¤æ‚çš„è°ƒè¯•å·¥ä½œï¼Œè¿™æ—¶å€™ä½¿ç”¨æ‰‹åŠ¨è¾“å…¥å„ç§è°ƒè¯•å‘½ä»¤ä¼šæ˜¾å¾—æ•ˆç‡åº•ä¸‹ï¼Œå¹¶ä¸”éš¾ä»¥é‡å¤ï¼Œæ— æ³•æ»¡è¶³éœ€æ±‚å¯¹è°ƒè¯•æ•ˆç‡çš„éœ€æ±‚ï¼Œè¿™æ—¶å€™é€šè¿‡ä½¿ç”¨è°ƒè¯•è„šæœ¬çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿè‡ªåŠ¨åŒ–çš„å¯¹ç¨‹åºè¿›è¡Œè°ƒè¯•ï¼Œèƒ½å¤Ÿæå¤§çš„æé«˜è°ƒè¯•çš„æ•ˆç‡ã€‚

GDBçš„è°ƒè¯•è„šæœ¬çš„åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š

```bash
gdb --command=automate-debug.gs --batch --args a.out
```

ä»¥ä¸Šä¸€èŠ‚çš„ä¾‹å­æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè°ƒè¯•è¿‡ç¨‹ä¸­ç”¨åˆ°çš„å‘½ä»¤å†™å…¥è„šæœ¬ä¸­ã€‚

```gdb
set height 0

break main.c:15

command
    print {data[0],data[1],data[2]}
    continue
end

run

quit
```

æœ€ç»ˆè¿è¡Œç»“æœå¦‚ä¸‹ï¼š

```bash
â”ŒğŸ’  iceyer @ ğŸ’»  alienware-deepin in ğŸ“  8.2-command-debug on ğŸŒ¿  master âŒ€4 âœ—
â””â¯ gdb --command=automate-debug.gs --batch --args a.out
Breakpoint 1 at 0x6b0: file main.c, line 15.
before sort:
data[0] is key=10, value=1
data[1] is key=10, value=2
data[2] is key=2, value=3

Breakpoint 1, sort (data=0x7fffffffc590, size=3) at main.c:15
15	            if (data[j].key >= data[j + 1].key)
$1 = {{key = 10, value = 1}, {key = 10, value = 2}, {key = 2, value = 3}}

Breakpoint 1, sort (data=0x7fffffffc590, size=3) at main.c:15
15	            if (data[j].key >= data[j + 1].key)
$2 = {{key = 10, value = 2}, {key = 10, value = 1}, {key = 2, value = 3}}

Breakpoint 1, sort (data=0x7fffffffc590, size=3) at main.c:15
15	            if (data[j].key >= data[j + 1].key)
$3 = {{key = 10, value = 2}, {key = 2, value = 3}, {key = 10, value = 1}}

after sort:
data[0] is key=2, value=3
data[1] is key=10, value=2
data[2] is key=10, value=1
[Inferior 1 (process 28107) exited normally]
```